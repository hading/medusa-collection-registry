= render 'show_breadcrumbs'

.pull-right
  = link_to 'Create FITS for tree', create_fits_for_tree_cfs_directory_path(@directory), method: :post, class: 'btn btn-default'
  - if can? :export, @file_group
    = link_to 'Download Files', export_cfs_directory_path(@directory), method: :post, class: 'btn btn-default'
    = link_to 'Download Files and All Subdirectories', export_tree_cfs_directory_path(@directory), method: :post, class: 'btn btn-default'

%h3 Directory: #{@directory.path}
- if @file_group
  %h4 File Group: #{link_to @file_group.name, @file_group}

%hr

%table#files.table.table-striped
  %thead
    %tr
      %th Name
      %th Size
      %th Last Modified
      %th FITS
  %tbody
    - @directory.subdirectories.order(:path).each do |subdirectory|
      %tr
        %td{'data-sort' => "a-#{subdirectory.path}"}
          = fa_icon 'folder-o'
          = link_to subdirectory.path, cfs_directory_path(subdirectory)
        %td
        %td
        %td
    - @directory.cfs_files.each do |file|
      %tr
        %td{'data-sort' => "b-#{file.name}"}
          = fa_icon 'file-o'
          = link_to file.name, cfs_file_path(file)
        %td= file.size
        %td= file.mtime
        %td
          - if file.fits_xml
            = link_to 'View XML', fits_xml_cfs_file_path(file)
          - else
            = link_to 'Create XML', create_fits_xml_cfs_file_path(file, method: :post)